<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="renderer" content="webkit">

    <title>考试成绩评估分析系统</title>
    <meta name="keywords" content="">
    <meta name="description" content="">

    <link href="css/bootstrap.min.css?v=3.4.0" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css?v=4.3.0" rel="stylesheet">

    <!-- Data Tables -->
    <link href="css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">

    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css?v=2.2.0" rel="stylesheet">

</head>

<body>
    <div id="wrapper">
        <nav class="navbar-default navbar-static-side" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav" id="side-menu">
                    <li class="nav-header">

                        <div class="dropdown profile-element"> <span>
                            <img alt="image" class="img-circle" src="img/bg.png" />
                             </span>
                            <a data-toggle="dropdown" class="dropdown-toggle" href="index.html#">
                                <span class="clear"> <span class="block m-t-xs"> <strong class="font-bold" id="user_name">Beaut</strong>
                             </span>  <span class="text-muted text-xs block">+ <b class="caret"></b></span> </span>
                            </a>
                            <ul class="dropdown-menu animated fadeInRight m-t-xs">
                                <li><a href="profile.html">个人资料</a>
                                </li>
                                <li class="divider"></li>
                                <li><a href="login.html">安全退出</a>
                                </li>
                            </ul>
                        </div>
                        <div class="logo-element">
                            H+
                        </div>

                    </li>
                    <li>
                        <a href="index.html"><i class="fa fa-th-large"></i> <span class="nav-label">课程管理</span> <span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li><a href="course_viewall.html">查看所有课程</a>
                            </li>
                            <li><a href="course_create.html">增加课程</a>
                            </li>
                            <li><a href="course_delete.html">删除课程</a>
                            </li>
                            <li><a href="course_modify.html">修改课程</a>
                            </li>
                            <li><a href="course_query.html">查询课程</a>
                            </li>
                        </ul>
                    </li>
                    
                    <li>
                      <a href="index.html"><i class="fa fa-th-large"></i> <span class="nav-label">老师管理</span> <span class="fa arrow"></span></a>
                      <ul class="nav nav-second-level">
                        <li><a href="teacher_viewall.html">查看所有老师</a>
                        </li>
                        <li><a href="teacher_create.html">增加老师</a>
                        </li>
                        <li><a href="teacher_delete.html">删除老师</a>
                        </li>
                        <li><a href="teacher_modify.html">修改老师</a>
                        </li>
                        <li><a href="teacher_query.html">查看老师</a>
                        </li>
                        </ul>
                    </li>

                    <li>
                      <a href="index.html"><i class="fa fa-th-large"></i> <span class="nav-label">学生管理</span> <span class="fa arrow"></span></a>
                      <ul class="nav nav-second-level">
                        <li><a href="student_viewall.html">查看所有学生</a>
                        </li>
                        <li><a href="student_create.html">增加学生</a>
                        </li>
                        <li><a href="student_delete.html">删除学生</a>
                        </li>
                        <li><a href="student_modify.html">修改学生</a>
                        </li>
                        <li><a href="student_query.html">查看学生</a>
                        </li>
                        </ul>
                    </li>

                    <li>
                      <a href="index.html"><i class="fa fa-th-large"></i> <span class="nav-label">试卷管理</span> <span class="fa arrow"></span></a>
                      <ul class="nav nav-second-level">
                        <li><a href="paper_viewall.html">查看所有试卷</a>
                        </li>
                        <li><a href="paper_create.html">创建试卷</a>
                        </li>
                        <li><a href="paper_delete.html">删除试卷</a>
                        </li>
                        <li><a href="paper_modify.html">修改试卷</a>
                        </li>
                        <li><a href="paper_query.html">查看试卷</a>
                        </li>
                        </ul>
                    </li>

                    <li class="active">
                      <a href="index.html"><i class="fa fa-th-large"></i> <span class="nav-label">成绩分析</span> <span class="fa arrow"></span></a>
                      <ul class="nav nav-second-level">
                        <li><a href="score_viewall.html">查看所有成绩</a>
                        </li>
                        <li class="active"><a href="score_create.html">上传成绩</a>
                        </li>
                        <li><a href="score_delete.html">删除成绩</a>
                        </li>
                        <li><a href="score_modify.html">修改成绩</a>
                        </li>
                        <li><a href="score_query.html">查询成绩</a>
                        </li>
                        <li><a href="score_analysis.html">成绩分析</a>
                        </li>
                      </ul>
                    </li>

                </ul>

            </div>
        </nav>

        <div id="page-wrapper" class="gray-bg dashbard-1">
            <div class="row border-bottom">
                <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">

                    <ul class="nav navbar-top-links navbar-right">
                        <li>
                            <span class="m-r-sm text-muted welcome-message"><a href="index.html" title="返回首页"><i class="fa fa-home"></i></a>欢迎使用</span>
                        </li>

                        <li>
                            <a href="login.html">
                                <i class="fa fa-sign-out"></i> 退出
                            </a>
                        </li>
                    </ul>

                </nav>
            </div>
            <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-lg-10">
                    <h2>上传成绩</h2>
                    <ol class="breadcrumb">
                        <li>
                            <a href="index.html">考试成绩评估分析系统</a>
                        </li>
                        <li>
                            <a href="#">成绩分析</a>
                        </li>
                        <li>
                            <strong>上传成绩</strong>
                        </li>
                    </ol>
                </div>
                <div class="col-lg-2">

                </div>
            </div>
            <div class="wrapper wrapper-content animated fadeInRight">
                <div class="row">

                  <div class="col-sm-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>成绩描述</h5>
                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                    <a class="close-link">
                                        <i class="fa fa-times"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content">
                                <form role="form" class="form-horizontal m-t">
                                    <div class="form-group draggable ui-draggable">
                                        <label class="col-sm-1 control-label">学生ID</label>
                                        <div class="col-sm-3">
                                            <input type="text" name="student_id" class="form-control" placeholder="请输入学生ID">
                                        </div>
                                    </div>
                                    <div class="form-group draggable ui-draggable">
                                        <label class="col-sm-1 control-label">教师ID</label>
                                        <div class="col-sm-3">
                                            <input type="text" name="teacher_id" class="form-control" placeholder="请输入教师ID">
                                        </div>
                                    </div>
                                    <div class="form-group draggable ui-draggable">
                                        <label class="col-sm-1 control-label">试卷ID</label>
                                        <div class="col-sm-3">
                                            <input type="text" name="paper_id" class="form-control" placeholder="请输入试卷ID"></input>
                                        </div>
                                        <div class="col-sm-2">
                                        	<button id="paper-load" class="btn btn-white btn-block"><i class="glyphicon glyphicon-cloud-download"></i>加载试卷信息</button>
                                    	</div>
                                    </div>
                                    
                                    <div class="hr-line-dashed"></div>
                                    
                                    <div class="form-group draggable ui-draggable">
                                        <label class="col-sm-1 control-label"></label>
                                        <div class="col-sm-9">
                                        		<div class="form-group col-sm-12" style="margin-buttom:10px;">
                                        			<label class="col-sm-1">试卷名</label>
                                                	<input type="text" class="col-sm-2" id="paper-id" readonly="readonly">
                                        			<label class="col-sm-1">总分</label>
                                                	<input type="text" class="col-sm-2" id="paper-total-score" readonly="readonly">
                                                </div>
		                                        <div class="col-sm-12">
													<table
														class="table table-striped table-bordered table-hover dataTables-example">
														<thead>
															<tr>
															<th>题目</th>
															<th>难度</th>
															<th>难度系数</th>
															<th>分数</th>
															<th>得分</th>
															<th>评价</th>
														</tr>
													</thead>
													<tbody id="tbody-data">
													</tbody>
												</table>
											</div>
										</div>
                                    </div>
                                    
                                    <div class="hr-line-dashed"></div>
                                    
                                    <div class="draggable ui-draggable">
                                        <div class="col-sm-12 col-sm-offset-1">
                                            <button id="form-submit" class="btn btn-primary" type="text">上传保存</button>
                                            <button id="form-cancel" class="btn btn-white" type="text">取消</button>
                                        </div>
                                    </div>
                                </form>
                                <iframe id="rfFrame" name="rfFrame" src="about:blank" style="display:none;"></iframe>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>

                    <div class="modal inmodal fade" id="myModal-result" tabindex="-1" role="dialog"  aria-hidden="true">
                      <div class="modal-dialog modal-sm">
                        <div class="modal-content">
                          <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                            <h4 class="modal-title">添加结果</h4>
                          </div>
                          <div class="modal-body">
                            <p id="myModal-result-p">添加失败</p>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">关闭</button>
                          </div>
                        </div>
                      </div>
                    </div>

                </div>
            </div>
            <div class="footer">
                <div class="pull-right">
                </div>
                <div>
                </div>
            </div>

        </div>
    </div>

    <!-- Mainly scripts -->
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/bootstrap.min.js?v=3.4.0"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <script src="js/plugins/jeditable/jquery.jeditable.js"></script>

    <!-- Data Tables -->
    <script src="js/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="js/plugins/dataTables/dataTables.bootstrap.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="js/hplus.js?v=2.2.0"></script>
    <script src="js/plugins/pace/pace.min.js"></script>

    <!-- Page-Level Scripts -->
    <script>

    function make_paper_templete(data) {
    	//alert(data);
        var paper_detail = eval("("+data+")");
    	paper_detail.items.detail = eval("(" + paper_detail.items.detail + ")");
    	
    	$('#paper-id').val(paper_detail.items.detail.paper_name);
    	$('#paper-total-score').val(paper_detail.items.detail.paper_total_score);
    	var tbody = $('#tbody-data');
    	var tbody_html = "";
    	
    	var items = paper_detail.items.detail.items;
    	$.each(items, function(i, item) {
    		$.each(item.data, function(j, data) {
    			tbody_html += "<tr>";
    	        tbody_html += "<td>" + item.type + (j+1) + "</td>"
    	        tbody_html += "<td>" + data.level_str + "</td>"
    	        tbody_html += "<td>" + data.level_index + "</td>"
    	        tbody_html += "<td>" + data.score + "</td>"
    	        tbody_html += "<td>" + "<input type=\"text\">" + "</td>"
    	        tbody_html += "<td>" + "<input type=\"text\" placeholder=\"无\">" + "</td>"
    	        tbody_html += "</tr>";
    		});
    	});
    	
        //$.each(json.items, function(i, item) {
        //  tbody_html += "<tr class=\"gradeX\">";
        //  $.each(json.thead, function(i, thead_item) {
         //   tbody_html += "<td>" + item[thead_item] + "</td>"
        //  });
        //  tbody_html += "</tr>";
        //});
        tbody.html(tbody_html);
    }
    function load_paper_by_id(_id) {
    	$.ajax({
            url: 'api/json.do',
            type: "POST" ,
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
            data: {
              func: "paper",
              param1: "query_by_id",
              param2: JSON.stringify({ id:_id }),
            },
            success: function(data) {
              make_paper_templete(data);
            }
          });
    }
    
     document.forms[0].target="rfFrame";

     $(document).ready(function(){
       $("#form-submit").click(function(){
         //alert($("form").serialize());
         $.ajax({
           url: 'api/json.do',
           type: "POST" ,
           contentType: "application/x-www-form-urlencoded; charset=UTF-8",
           //dataType:'json',
           data: {
             func: "score",
             param1: "create",
             param2: (function() {

            	 var detail = {
            			 student_id: $("input[name='student_id']").val(),
		    	 		 teacher_id: $("input[name='teacher_id']").val(),
		    			 paper_id: $("input[name='paper_id']").val(),
    			 		 paper_name: $("#paper-id").val(),
            	 		 paper_total_score: $("#paper-total-score").val(),
            			 data:[]
            	 };
            	 
            	 trs = $('#tbody-data tr');
            	 $.each(trs, function(i, tr) {
            		 var _type = tr.children[0].innerText;
	           		 var _level_str = tr.children[1].innerText;
	        		 var _level_index = tr.children[2].innerText;
	        		 var _score_total = tr.children[3].innerText;
	        		 var _score_real = tr.children[4].children[0].value
	        		 var _comments = tr.children[5].children[0].value;
	        		 
	        		 detail.data.push({
	        			 type: _type,
	        			 level_str: _level_str,
	        			 level_index: _level_index,
	        			 score_total: _score_total,
	        			 score_real: _score_real,
	        			 comments: _comments
	        		 });
	             });
            	 
            	 var detail_str = JSON.stringify(detail);
            	 var ret = $("form").serialize()+"&creater=1" + "&detail=" + detail_str;
            	 return ret;
             })(),
           },
           success: function(data) {
             //alert(data);
             var json = eval("("+data+")");
             $("#myModal-result-p").text(json.result);
             $('#myModal-result').modal('show');
           }
         });
       });
       
       $("#paper-load").click(function(){
    	   id = $("[name='paper_id']").val();
    	   load_paper_by_id(id);
       });
     });

    </script>

</body>

</html>
