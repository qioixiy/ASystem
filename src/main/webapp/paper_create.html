<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="renderer" content="webkit">

    <title>考试成绩评估分析系统</title>
    <meta name="keywords" content="">
    <meta name="description" content="">

    <link href="css/bootstrap.min.css?v=3.4.0" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css?v=4.3.0" rel="stylesheet">

    <!-- Data Tables -->
    <link href="css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">

    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css?v=2.2.0" rel="stylesheet">

</head>

<body>
    <div id="wrapper">
        <nav class="navbar-default navbar-static-side" role="navigation">
            <div class="sidebar-collapse">
                <ul class="nav" id="side-menu">
                    <li class="nav-header">

                        <div class="dropdown profile-element"> <span>
                            <img alt="image" class="img-circle" src="img/bg.png" />
                             </span>
                            <a data-toggle="dropdown" class="dropdown-toggle" href="index.html#">
                                <span class="clear"> <span class="block m-t-xs"> <strong class="font-bold" id="user_name">${userName}</strong>
                             </span>  <span class="text-muted text-xs block">+ <b class="caret"></b></span> </span>
                            </a>
                            <ul class="dropdown-menu animated fadeInRight m-t-xs">
                                <li><a href="profile.html">个人资料</a>
                                </li>
                                <li class="divider"></li>
                                <li><a href="login.html">安全退出</a>
                                </li>
                            </ul>
                        </div>
                        <div class="logo-element">
                            H+
                        </div>

                    </li>
                    <li>
                        <a href="index.html"><i class="fa fa-th-large"></i> <span class="nav-label">课程管理</span> <span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li><a href="course_viewall.html">查看所有课程</a>
                            </li>
                            <li><a href="course_create.html">增加课程</a>
                            </li>
                            <li><a href="course_delete.html">删除课程</a>
                            </li>
                            <li><a href="course_modify.html">修改课程</a>
                            </li>
                            <li><a href="course_query.html">查询课程</a>
                            </li>
                        </ul>
                    </li>
                    
                    <li>
                      <a href="index.html"><i class="fa fa-th-large"></i> <span class="nav-label">老师管理</span> <span class="fa arrow"></span></a>
                      <ul class="nav nav-second-level">
                        <li><a href="teacher_viewall.html">查看所有老师</a>
                        </li>
                        <li><a href="teacher_create.html">增加老师</a>
                        </li>
                        <li><a href="teacher_delete.html">删除老师</a>
                        </li>
                        <li><a href="teacher_modify.html">修改老师</a>
                        </li>
                        <li><a href="teacher_query.html">查看老师</a>
                        </li>
                        </ul>
                    </li>

                    <li>
                      <a href="index.html"><i class="fa fa-th-large"></i> <span class="nav-label">学生管理</span> <span class="fa arrow"></span></a>
                      <ul class="nav nav-second-level">
                        <li><a href="student_viewall.html">查看所有学生</a>
                        </li>
                        <li><a href="student_create.html">增加学生</a>
                        </li>
                        <li><a href="student_delete.html">删除学生</a>
                        </li>
                        <li><a href="student_modify.html">修改学生</a>
                        </li>
                        <li><a href="student_query.html">查看学生</a>
                        </li>
                        </ul>
                    </li>

                    <li class="active">
                      <a href="index.html"><i class="fa fa-th-large"></i> <span class="nav-label">试卷管理</span> <span class="fa arrow"></span></a>
                      <ul class="nav nav-second-level">
                        <li><a href="paper_viewall.html">查看所有试卷</a>
                        </li>
                        <li class="active"><a href="paper_create.html">创建试卷</a>
                        </li>
                        <li><a href="paper_delete.html">删除试卷</a>
                        </li>
                        <li><a href="paper_modify.html">修改试卷</a>
                        </li>
                        <li><a href="paper_query.html">查看试卷</a>
                        </li>
                        </ul>
                    </li>

                    <li>
                      <a href="index.html"><i class="fa fa-th-large"></i> <span class="nav-label">成绩分析</span> <span class="fa arrow"></span></a>
                      <ul class="nav nav-second-level">
                        <li><a href="score_viewall.html">查看所有成绩</a>
                        </li>
                        <li><a href="score_create.html">上传成绩</a>
                        </li>
                        <li><a href="score_delete.html">删除成绩</a>
                        </li>
                        <li><a href="score_modify.html">修改成绩</a>
                        </li>
                        <li><a href="score_query.html">查询成绩</a>
                        </li>
                        <li><a href="score_analysis.html">成绩分析</a>
                        </li>
                      </ul>
                    </li>

                </ul>

            </div>
        </nav>

        <div id="page-wrapper" class="gray-bg dashbard-1">
            <div class="row border-bottom">
                <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">

                    <ul class="nav navbar-top-links navbar-right">
                        <li>
                            <span class="m-r-sm text-muted welcome-message"><a href="index.html" title="返回首页"><i class="fa fa-home"></i></a>欢迎使用</span>
                        </li>

                        <li>
                            <a href="login.html">
                                <i class="fa fa-sign-out"></i> 退出
                            </a>
                        </li>
                    </ul>

                </nav>
            </div>
            <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-lg-10">
                    <h2>创建新的试卷</h2>
                    <ol class="breadcrumb">
                        <li>
                            <a href="index.html">考试成绩评估分析系统</a>
                        </li>
                        <li>
                            <a href="#">试卷管理</a>
                        </li>
                        <li>
                            <strong>增加试卷</strong>
                        </li>
                    </ol>
                </div>
                <div class="col-lg-2">

                </div>
            </div>
            <div class="wrapper wrapper-content animated fadeInRight">
                <div class="row">

                  <div class="col-sm-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>试卷描述</h5>
                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-up"></i>
                                    </a>
                                    <a class="close-link">
                                        <i class="fa fa-times"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content">
                                <form role="form" class="form-horizontal m-t">
                                    <div class="form-group draggable ui-draggable">
                                        <label class="col-sm-1 control-label">试卷名字</label>
                                        <div class="col-sm-7">
                                            <input type="text" name="paper-name" class="form-control" placeholder="请输入课程名字">
                                        </div>
                                    </div>
                                    <div class="form-group draggable ui-draggable">
                                        <label class="col-sm-1 control-label">所属课程</label>
                                        <div class="col-sm-9">
	                                        <div class="input-group">
		                                        <select  name="paper-course-id" class="form-control m-b" id="course_id">
                                                <option>请选择所属课程</option>
                                            	</select>
	                                        </div>
	                                   </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="col-sm-1 control-label">试卷内容</label>
                                        <div class="col-sm-2">
                                        	<button id="paper-create-class" class="btn btn-white btn-block"><i class="glyphicon glyphicon-plus"></i>添加题型</button>
                                        </div>
                                        <label class="col-sm-1 control-label">总分</label>
                                        <div class="col-sm-1">
                                            <input type="text" name="paper-total-score" class="form-control" placeholder="100分">
                                        </div>
                                    </div>
                                    
                                    <div class="hr-line-dashed"></div>
                                    
                                    <div id="paper-detail-data">
	                                </div>
                                    
                                    <div class="hr-line-dashed"></div>
                                    <div class="draggable ui-draggable">
                                        <div class="col-sm-12">
                                            <button id="form-submit" class="btn btn-primary">保存课程</button>
                                            <button id="form-cancel" class="btn btn-white">取消</button>
                                        </div>
                                    </div>
                                </form>
                                <iframe id="rfFrame" name="rfFrame" src="about:blank" style="display:none;"></iframe>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>

                    <div class="modal inmodal fade" id="myModal-result" tabindex="-1" role="dialog"  aria-hidden="true">
                      <div class="modal-dialog modal-sm">
                        <div class="modal-content">
                          <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                            <h4 class="modal-title">添加结果</h4>
                          </div>
                          <div class="modal-body">
                            <p id="myModal-result-p">添加失败</p>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">关闭</button>
                          </div>
                        </div>
                      </div>
                    </div>

                </div>
            </div>
            <div class="footer">
                <div class="pull-right">
                </div>
                <div>
                </div>
            </div>

        </div>
    </div>

    <!-- Mainly scripts -->
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/bootstrap.min.js?v=3.4.0"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <script src="js/plugins/jeditable/jquery.jeditable.js"></script>

    <!-- Data Tables -->
    <script src="js/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="js/plugins/dataTables/dataTables.bootstrap.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="js/hplus.js?v=2.2.0"></script>
    <script src="js/plugins/pace/pace.min.js"></script>

    <!-- Page-Level Scripts -->
    <script>

     document.forms[0].target="rfFrame";

     $(document).ready(function(){

       $("#paper-create-class").click(function(){
         detail = $("#paper-detail-data");
         detail.append(
           "<div class=\"form-group\">" +
	   "<div class=\"col-sm-12\">" +
	   "<div class=\"ibox float-e-margins\">" +
	   "<div class=\"ibox-title\">" +
	   "<input type=\"text\" placeholder=\"请输入题型:选择|填空|简答|...\">" +
	   "<button class=\"btn btn-info btn-sm paper-add-item\" type=\"text\" style=\"margin-left:10px\">添加题目</button>" +
	   "<div class=\"ibox-tools\">" +
	   "<a class=\"collapse-link\"> <i class=\"fa fa-chevron-up\"></i> </a>" +
	   "<a class=\"close-link\"> <i class=\"fa fa-times\"></i> </a>" +
	   "</div>" +
	   "</div>" +
	   "<div class=\"ibox-content\" style=\"display: block;\">" +
	   "</div>" +
	   "</div>" +
	   "</div>" +
           "</div>");

         // Close ibox function
         $('.close-link').unbind('click');
         $('.close-link').click( function() {
           var content = $(this).closest('div.ibox');
           content.remove();
         });

         // Collapse ibox function
         $('.collapse-link').unbind('click');
         $('.collapse-link').click( function() {
           var ibox = $(this).closest('div.ibox');
           var button = $(this).find('i');
           var content = ibox.find('div.ibox-content');
           content.slideToggle(200);
           button.toggleClass('fa-chevron-up').toggleClass('fa-chevron-down');
           ibox.toggleClass('').toggleClass('border-bottom');
           setTimeout(function () {
             ibox.resize();
             ibox.find('[id^=map-]').resize();
           }, 50);
         });

         //js/hplus.js?v=2.2.0
         $('.paper-add-item').unbind('click');
         $(".paper-add-item").click(function(){
      	   item = $(this);
      	   ibox_content = item.parent();
      	   var number = ibox_content.find('.alert').size()+1;
      	   ibox_content.append(
      	     "<div class=\"alert alert-success alert-dismissable\">" +
      	     "<span>" +
      	     "<div class=\"paper-item\">" +
      	     "<span class=\"label label-primary\">"+"题目"+number+"</span>" +
	      	 "<select class=\"col-sm-2\" style=\"height:25px; margin-left:10px\">" +
	      	 "<option value=\"0\">选择难度</option>" +
	      	 "<option value=\"1\">基础题目</option>" +
	      	 "<option value=\"2\">中等难度</option>" +
	      	 "<option value=\"3\">高难度题目</option>" +
	      	 "</select>" +
	      	 "<input type=\"text\" placeholder=\"分配分数\" class=\"col-sm-1\" style=\"margin-left:10px\">" +
         	 "</div>" +
      	     "</span>" +
      	     "<span>&nbsp</span>" +
             "<button aria-hidden=\"true\" data-dismiss=\"alert\" class=\"close\" type=\"button\">×</button>" +
             "</div>")
         });
       });

       $("#form-submit").click(function(){
         //alert($("form").serialize());
         get_param2 = function() {
        	 var class_items = $('#paper-detail-data .form-group');
        	 var paper_name_v = $('.ibox-content .form-group input')[0].value;
        	 var paper_total_score_v = $('.ibox-content .form-group input')[1].value;
        	 if (paper_total_score_v === "") {paper_total_score_v = "100"}
        	 class_items_result = {
        			 paper_name:paper_name_v,
        			 paper_total_score:paper_total_score_v,
        			 items:[]
        	 };
        	 for (var index = 0;  index < class_items.length; index++) {
        		 if( class_items[index].children[0].children.length == 0) {
        			 continue;
        		 }
            	 var class_item = class_items[index].children[0].children[0].children[0].children;
            	 // 题目类型
            	 var item_type = class_item[0].value;
            	 class_item_result = {type:item_type, data: []};
            	 
            	 var array = [].slice.call(class_item);
            	 // 取出题目项数据
            	 var arr = array.slice(3);
            	 for (i in arr) {
            		 // 题目难度值
            		 var exam_question_level = arr[i].childNodes[0].childNodes[0].childNodes[1];
            		 var exam_question_level_index = exam_question_level.value;
            		 var exam_question_level_str = exam_question_level.selectedOptions[0].text
            		 // 题目对应的分数
            		 var exam_question_score = arr[i].childNodes[0].childNodes[0].childNodes[2];
            		 var exam_question_score_str = exam_question_score.value;
            		 
            		 class_item_result.data.push(
            				 {
            					 name:1,
            					 level_index: exam_question_level_index,
            					 level_str: exam_question_level_str,
            					 score: exam_question_score_str,
            				 }
            		 );
            	 }
        		 class_items_result.items.push(class_item_result);
        	 }
        	 var detail_class = $('#paper-detail-data .form-group');
        	 
        	 var paper_detail = JSON.stringify(class_items_result);
        	 var creater = 1;
        	 var form_names_serial = $("form").serialize();
             var ret = form_names_serial +"&creater=" + creater + "&paper-detail=" + paper_detail;
             alert(ret);
        	 return ret;
         };

         $.ajax({
           url: 'api/json.do',
           type: "POST" ,
           contentType: "application/x-www-form-urlencoded; charset=UTF-8",
           //dataType:'json',
           data: {
             func: "paper",
             param1: "create",
             param2: get_param2(),
           },
           success: function(data) {
             //alert(data);
             var json = eval("("+data+")");
             $("#myModal-result-p").text(json.result);
             $('#myModal-result').modal('show');
           }
         });
       });

       // 获取课程列表
       $.ajax({
       url: 'api/json.do',
       type: "POST" ,
       contentType: "application/x-www-form-urlencoded; charset=UTF-8",
       //dataType:'json',
       data: {
         func: "course",
         param1: "get_list",
         param2: $("form").serialize()+"&creater=1",
       },
       success: function(data) {
         //alert(data);
         var json = eval("("+data+")");
         for (item in json.items) {
        	 value = json.items[item].id;
        	 text = json.items[item].name;
         	$("#course_id").append("<option value='"+value+"'>"+text+"</option>");
         }
       }
     });

     });

    </script>

</body>

</html>
